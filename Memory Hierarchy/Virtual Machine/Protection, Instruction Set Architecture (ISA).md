-----
### 보호와 명령어 집합 구조
-----
1. 보호가 컴퓨터 구조와 운영체제의 공동 작업이긴 하지만, 가상 메모리가 널리 사용되자 컴퓨터 구조 설계자들은 기존 명령어 집합 구조의 어색한 점들을 수정해야 했음
2. 예) x86 명령어 POPF는 메모리에 있는 스택 맨 위의 값을 플래그 레지스터에 넣는 명령어
   - 플래그들 중 하나로 인터럽트를 허용(Interrupt Enable, IE) 플래그가 있음
   - 사용자 모드에서 POPF 명령어를 실행하면, 트랩을 발생시키는 대신 단순히 IE 플래그를 제외한 모든 플래그를 변경
   - IE 플래그는 POPF 명령어를 시스템 모드에서 실행해야 변경
   - 손님 OS는 VM에서 사용자 모드로 동작하는데, 손님 OS가 원하는 것은 IE 플래그의 값이 바뀌는 것때문에 문제가 됨

3. 역사적으로 가상 머신 성능을 향상시키기 위해 IBM 메인프레임 하드웨어와 VMM은 세 가지 단계를 밟아옴
   - 프로세서 가상화 비용을 줄임
   - 가상화로 인한 인터럽트 오버헤드 비용을 줄임
   - VMM 호출 없이 적절한 VM에게 인터럽트를 처리하게 하여 인터럽트 비용을 줄임

4. 가상화할 마지막 부분은 I/O
   - 컴퓨터에 부착되는 I/O 장치의 수가 증가하고 I/O 장치 종류의 다양성도 증가하므로 이 부분이 시스템 가상화에서 가장 어려운 부분
   - 또 다른 어려움은 여러 VM들이 실제 장치를 공유하는 문제
   - 또한, 필요한 수 많은 디바이스 드라이버 지원도 어려운 문제로, 같은 VM 시스템에서 여러 손님 OS를 지원할 때는 이 문제가 더 어려워짐
     + 각 VM에는 I/O 디바이스 드라이버의 일반적 버전을 제공하고 실제 I/O를 다루는 일은 VMM에 맡김으로 VM의 환상을 유지할 수 있음
