-----
### 가상 머신
-----
1. 가상 머신(Virtual Machine, VM)은 1960년대 중반 처음 개발되었으며, 수십년이 지난 지금도 여전히 메인프레임 컴퓨터의 중요한 부분으로 남아있음
2. 19980년대와 1990년대 단일 사용자 PC 영역에서는 거의 사용되지 않았지만, 다음과 같은 이유로 인기를 얻고 있음
   - 현대 시스템에서 격리와 보안에 관한 중요도 증가
   - 표준 운영체제의 보안성과 신뢰성 실패
   - 관련 없는 많은 사용자들이 한 컴퓨터를 공유하는 현상 (클라우드 컴퓨팅)
   - 최근 수십 년간 프로세서 속도의 획기적 발전으로 VM의 오버헤드를 더 잘 감당할 수 있게 됨

3. VM의 가장 넓은 정의는 기본적으로 Java VM 같이 표준 소프트웨어 인터페이스를 제공하는 모든 에뮬레이션 방법들을 포함
   - 여기서는 이진 명령어 집합 구조(ISA) 수준에서 완전한 시스템 계층 환경을 제공하는 VM
   - 어떤 VM들은 실제 하드웨어와는 다른 ISA를 실행하기도 하지만, 여기서는 항상 하드웨어와 일치하는 ISA를 실행한다고 가정
     + 이런 VM을 운영체제 가상머신(Operating System Virtual Machine) 또는 시스템 가상 머신(System Virtual Machine)이라고 부르며, IBM VM/370, VirtualBox, VMware ESX Server, Xen 들이 예

4. 운영체제 가상 머신은 사용자들에게 전체 컴퓨터를 자신만이 쓰고 있다는 환상을 제공 (운영체제도 포함)
   - 한 컴퓨터가 여러 개의 VM을 실행하여, 여러 개 다른 운영체제(Operating System, OS)들을 지원할 수 있음
   - 전통적인 플랫폼에서는 한 OS가 모든 하드웨어 자원을 차지하지만, VM을 이용하면 여러 개의 운영체제가 하드웨어 자원을 공유할 수 있음

5. VM을 지원하는 소프트웨어를 가상 머신 모니터(Virtual Machine Monitor, VMM) 또는 하이퍼바이저(Hypervisor)라고 부르며, 가상 머신 기술의 핵심
   - 기반이 되는 하드웨어 플랫폼을 호스트(Host)라고 하고, 호스트의 자원은 손님(Guest) VM들이 공유
   - VMM은 가상 자원(Virtual Resource)을 어떻게 물리 자원(Physical Resource)으로 사상할 것인지 결정
   - 물리 자원은 시분할(Time-Shared)이나 공간 분할(Partitioned)로 공유되며, 심지어는 소프트웨어로 애뮬레이션 되기도 함
   - VMM은 전통적인 OS보다 훨씬 작으며, VMM의 독립적인 부분은 아마도 겨우 10,000줄로 구성될 것

6. VM은 상업적으로 두 가지 이점을 제공
   - 소프트웨어 관리 : VM은 완벽한 소프트웨어 스택을 실행할 수 있는 추상화를 제공
     + 심지어는 DOS 같은 오래된 운영체제도 포용
     + 전형적인 형태는 과거에 사용되던 OS를 실행하는 VM들이 몇 개 있고, 현재의 안정적인 OS를 실행하는 VM들도 여러 개 있고, 일부 VM은 차세대 OS를 테스트하는 구성

   - 하드웨어 관리
     + 서버를 여러 개 사용하는 이유 중 하나는 각 응용 프로그램을 적합한 운영체제를 갖춘 별도의 컴퓨터에서 실행하기 위해서임
     + 이렇게 분리하면 신용도를 개선할 수 있음
     + VM은 이 여러 소프트웨어 스택이 하드웨어는 공유하지만, 실행은 독립적으로 할 수 있게 함
     + 또 다른 예는 부하 평형이나 고장 난 하드웨어의 제거를 위해 실행 중인 VM을 다른 컴퓨터로 옮기는 작업을 VMM이 지원하는 것

7. AWS(Amazon Web Services)가 EC2를 제공하는 클라우드 컴퓨팅에서 가상 머신을 사용하는 이유
   - 사용자들이 같은 서버를 공유하면서도 각자를 보호할 수 있도록 해 줌
   - 창고 규모 컴퓨터에서 소프트웨어를 간단하게 배포 가능
     + 고객이 적합한 소프트웨어로 구성된 가상 머신 이미지를 설치하면, AWS가 이 소프트웨어를 사용하고자 하는 모든 고객에게 배포
   - 고객(그리고 AWS)이 작업을 끝냈을 때, VM을 확실하게 종료시켜서 자원 사용 제어 가능
   - 가상 머신은 사용자가 어떤 하드웨어를 사용하는지 모르게 할 수 있음
     + 이는 AWS가 구식 서버를 유지하면서 동시에 효율적 신형 서버를 새로 도입할 수 있음을 뜻함
     + 고객은 자기가 기대하는 성능을 EC2 Compute Units 단위로 나타낼 수 있음
   - 가상 머신 모니터 VM이 프로세서, 네트워크, 디스크 공간을 사용하는 정도를 조절할 수 있음
     + 이렇게 함으로써 AWS는 같은 서버에서 실행되는 여러 유형의 인스턴스에 대해 다양한 가격을 제공할 수 있음

7. 일반적으로 프로세서 가상화의 비용은 작업부하에 달려 있음
   - 사용자 수준의 프로세서 실행 시간이 대부분을 차지하는 프로그램은 가상화 오버헤드가 거의 없는데, OS가 거의 호출되지 않아서 모든 것들이 원래 속도로 동작하기 때문임
   - I/O 집약적인 작업부하는 일반적으로 OS 집약적이기도 함
     + 따라서 시스템 호출과 특권 명령어 사용이 많아 가상화 비용이 많이 발생
     + 그러나 작업부하가 I/O 집약적이면서 대부분 시간을 I/O에 소비하는 경우, 프로세서가 I/O를 기다리면서 아무 일도 하지 않는 시간이 많으므로 프로세서 가상화 비용을 오나전히 감출 수 있음

   - 오버헤드는 VMM에 의해 에뮬레이션되어야 하는 명령어의 개수와 각 명령어의 에뮬레이션 시간에 의해 결정
     + 따라서, 우리가 가정한 것처럼 손님 VM들이 호스트와 같은 ISA를 수행할 때, VMM과 구조의 공통 목적은 거의 모든 명령어를 실제 하드웨어가 직접 실행하는 것
