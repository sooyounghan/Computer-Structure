-----
### 가상 메모리, TLB, 캐시의 통합
-----
1. 가상 메모리와 캐시 시스템은 계층구조를 이루며 같이 동작
   - 따라서 데이터가 메인 메모리에 없다면, 그 데이터는 캐시에 있을 수 없음
   - 운영체제가 페이지를 디스크로 옮기기로 결정하면 캐시에서 해당 페이지를 제거함으로써 이 계층 구조를 유지하는 역할을 수행

2. 동시에 운영체제는 페이지 테이블과 TLB를 수정하여 메모리에서 제거된 페이지의 데이터에 접근하려고 시도하면 페이지 부재를 일으킴
3. 가장 좋은 경우는 가상 주소가 TLB에 의해 변환되고 캐시로 보내져서 원하는 데이터를 읽어 프로세서에게 보내는 것
4. 가장 안좋은 경우는 참조가 메모리 계층 구조의 세 부분, 즉, TLB / 페이지 테이블 / 캐시 모두에서 발생하는 경우
5. 메모리 계층 구조의 전체적인 동작
   - TLB와 캐시로 구성된 다음 그림과 같은 메모리 계층 구조에서 메모리 참조 시 세 가지 다른 형태의 실패(TLB 실패, 페이지 부재, 캐시 실패)가 발생할 수 있음
<div align="center">
<img src="https://github.com/user-attachments/assets/f0232855-d6e4-4cf8-b787-7e5d3e221d46">
</div>

   - 가능한 실패의 모든 조합과 이들이 실제 발생 가능 여부
<div align="center">
<img src="https://github.com/user-attachments/assets/33c5f7cc-25f6-4bd4-be4a-7f25581ae811">
</div>

   - 캐시에 접근하기 전 모든 메모리 주소가 실제 주소로 변환되는 것을 가정
   - 이 구조에서는 캐시가 실제 주소로 인덱스되고(Physically Indexed), 실제 주소로 태그(Physically Tagged) (캐시 인덱스와 태그가 가상 주소가 아닌 실제 주소)
   - 이런 시스템에서 캐시 적중 시 메모리 접근 시간은 TLB 접근 시간과 캐시 접근 시간을 포함하여야 하는데, 물론 이러한 접근은 파이프라인화 될 수 있음
   - 다른 방법으로는 프로세서가 완전히 또는 부분적으로 가상 주소를 이용해 캐시를 인덱스할 수 있음
     + 이를 가상 주소 캐시(Virtual Addressed Cache)라고 부르며, 가상 주소인 태그를 사용
     + 따라서, 이 캐시는 가상 주소로 인덱스되고(Virtually Indexed) 가상 주소로 태그(Virtually Tagged)
   - 이러한 캐시에는 주소 변환 하드웨어(TLB)가 정상적인 캐시 접근 시에는 사용되지 않음 : 실제 주소로 변환되지 않은 가상 주소로 캐시를 접근해야 하기 떄문임
   - 이 방법은 TLB가 접근 경로에서 제외되므로 캐시 지연을 줄여줌
   - 그러나 캐시 실패가 발생하면 프로세서는 가상 주소를 실제 주소로 변환하여 메인 메모리에서 캐시 블록을 가져오도록 해야 함
   - 캐시가 가상 주소로 접근 되고, 페이지가 프로세스들 사이에 공유될 때(프로세서 마다 다른 가상 주소로 접근할 수도 있음), 동의어 문제(Aliasing 또는 Synonym)가 발생할 가능성이 존재
     + 동의어 문제 : 같은 객체가 2개의 주소에 의해 접근되는 상황으로, 실제 페이지 하나에 가상 주소가 2개 존재하는 가상 메모리에서 발생할 수 있음
     + 동의어 문제는 같은 객체가 두 가지 이름을 갖는 경우 발생하며, 이 경우에는 동일 페이지에 2개의 가상 주소가 존재하는 것
     + 이런 페이지 내 워드가 각기 다른 가상 주소로 대응되는 2개의 다른 캐시 블록에 들어갈 수 있으므로, 모호함은 문제를 일으킴
     + 동의어 문제가 생기면 한 프로그램이 데이터를 바꾸어도 다른 프로그램은 데이터가 변화된 것을 모를 수 있음
     + 완전히 가상 주소를 사용하는 캐시는 동의어 문제를 줄이도록 캐시와 TLB 설계에 제약을 가하거나, 운영체제나 사용자가 동의어 문제가 발생하지 않도록 조치를 취해야 함

   - 타협점으로는 캐시의 인덱스는 가상 주소를 사용하고(주소의 페이지 변위 부분을 인덱스로 사용하는데, 변위는 번역되지 않으므로 실제 주소), 태그는 실제 주소를 사용하는 방식
     + 이 방식은 가상 주소 캐시의 좋은 성능과 실제 주소 캐시(실제 주소로 접근하는 캐시)의 단순한 구조 양쪽 장점을 다 얻을 수 있음
     + 예를 들어, 이 방식에는 동의어 문제가 발생하지 않음
     + 이 방법이 성공하기 위해서는 최소 페이지 크기, 캐시 크기, 연관 정도 사이에 조심스러운 조정 필요
