-----
### 분기에 따른 지연 줄이기
-----
1. 분기 성능을 향상시키는 한 가지 방법은 분기가 일어났을 때 반응을 줄이는 것
   - 이제까지의 분기 명령어의 경우 다음 PC 값은 MEM 단계에서 선정된다고 가정
   - 만약, 파이프라인에서 분기 결정을 좀 더 앞당겨 할 수 있으면, 더 적은 수의 명령어를 없애 버려도 됨
   - MIPS 구조는 큰 분기 손실을 치르지 않으면서 파이프라이닝할 수 있는 빠른 단일 사이클 분기를 지원하도록 설계
   - 많은 분기가 간단한 테스트(예) 같은지 또는 부호가 어떤지)에만 의존하며 그러한 테스트들은 완전한 ALU 연산을 필요로 하는 것이 아니고, 몇 개의 게이트들로 해낼 수 있음
   - 좀 더 복잡한 분기 결정이 필요할 때는 비교 수행을 위해 ALU를 사용하는 독립된 명령어가 요구되는데, 이는 분기를 위해 조건 코드를 사용하는 것과 비슷한 경우

2. 분기 결정을 앞으로 끌어올리려면 분기 목적지 주소를 계산하는 것과 분기 여부를 판단하는 것 두 가지 일이 더 일찍 발생해야 함
   - 이 중 쉬운 부분은 분기 주소 계산을 끌어올리는 것
   - IF / ID 파이프라인 레지스터에는 이미 PC 값과 수치 필드가 존재
   - 따라서, 분기 덧셈기를 EX 단계에서 ID 단계로 올기기만 하면 됨
   - 물론, 분기 목적지 주소 계산은 모든 명령어에 대해 수행될 것이지만, 사용은 필요할 때만 함

3. 어려운 부분은 분기 여부에 대한 판단
   - 같을 시 분기의 경우에는 같은지 알아보기 위해 ID 단계에서 읽은 두 레지스터의 값을 비교하여야 함
   - 두 레지스터 값을 비트별로 Exclusive-OR 하고, 그 결과 비트들을 OR 하여서 같은지 검사 (OR 게이트의 zero 출력은 두 레지스터가 같은 값이라는 것을 의미)
   - 분기 테스트를 ID 단계로 옮기는 것은 추가적인 전방전달 유닛과 해저드 검출 하드웨어를 필요로 한다는 것을 의미 : 아직 파이프라인 상에 있는 결과값에 종속적인 분기도 이 같은 최적화를 하면 제대로 동작할 수 있기 때문임
   - 예를 들면, 같을 시 분기(또한 그 역도 성립)를 구현하기 위해서 결과값들을 ID 단계에 있는 동등 여부 테스트 회로(Equality Test Logic)로 전방전달할 필요가 있지만, 복잡한 두 가지 문제 존재
     + 명령어를 해독하고 동등 여부 유닛에의 전방전달이 필요한지 결정하고, 또 동등한지 비교하는 일을 ID 단계 동안 끝내야 함
       * 그래야만 명령어가 분기할 경우 PC 값을 분기 목적지 주소로 바꿀 수 있음
       * 전에는 ALU 전방전달 회로가 분기 명령어의 피연산자들을 전방전달하였지만, ID 단게에 동등 여부 테스트 유닛을 도입하면 새로운 전방전달 회로가 필요
       * 분기 명령어를 위해 전방전달되는 근원지 피연산자들은 EX / MEM 파이프라인이나 MEM / WB 파이프라인 레지스터에서 옴

     + 분기 비교에 사용할 값들은 ID 단계에서 필요하지만, 더 나중에 생성될 수 있으므로 데이터 해저드가 일어나거나 지연이 필요하게 될 가능성이 존재
       * 예를 들어, 분기 명령어 바로 앞에 있는 ALU 명령어가 분기 비교를 위한 피연산자 중 하나를 생성하면 지연이 요구됨
       * 왜냐하면, ALU 명령어를 위한 EX 단계가 분기 명령어의 ID 사이클보다 뒤에 일어날 것이기 때문임
       * 좀 더 확장하면, 적재 명령어 바로 뒤에 적재 결과를 사용하는 조건부 분기 명령어가 뒤 따라 나오는 경우에는 두 사이클의 지연이 필요
       * 왜냐하면, 적재 명령어의 결과는 MEM 사이클의 끝에서 나오지만, 분기 명령어가 필요로 하는 것은 ID 단계의 시작점이기 때문임

4. 이 같은 어려움이 있지만, 분기 실행을 ID 단계로 옮기면 성능이 개선
   - 분기가 발생할 때의 분기 손실을 명령어 하나, 즉, 현재 인출되고 있는 명령어만으로 줄일 수 있기 때문임
   - IF 단계의 명령어를 버리기 위해 IF.Flush라는 제어선을 추가하는데, 이 제어선은 IF / ID 파이프라인 레지스터 명령어 필드를 0으로 변경
     + 이는 인출된 명령어를 nop으로 바꾸는 것인데, 이 명령어는 상태를 바꾸는 어떠한 일도 하지 않음

5. 예) 파이프라인 분기
   - 분기가 일어나지 않는 것으로 파이프라인이 최적화되어 있고, 분기 실행을 ID 단계로 옮겼다고 가정
<div align="center">
<img src="https://github.com/user-attachments/assets/db991b03-54ae-46c5-ba2a-6513adf84862">
</div>

   - 분기가 일어날 때의 그림
<div align="center">
<img src="https://github.com/user-attachments/assets/bc0ef910-edfd-41bc-b5ae-a07f9294af60">
</div>
